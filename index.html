<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/2.0.0/css/dataTables.bootstrap5.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/rowreorder/1.5.0/css/rowReorder.bootstrap5.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/responsive/3.0.0/css/responsive.bootstrap5.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" rel="stylesheet">
    <title>My KinMen Map</title>
    <style>
        .swiper-button-prev {
            display: none;
        }

        .swiper-button-next {
            display: none;
        }

        @media (max-width: 767.98px) {
            #my_table_wrapper {
                padding-left: 30px;
                padding-right: 30px;
            }

            .swiper-button-prev {
                display: block;
            }

            .swiper-button-next {
                display: block;
            }

            #my_table_wrapper .dt-paging {
                display: none;
            }
        }
    </style>
</head>
<body>
    <header>
        <nav class="navbar navbar-expand-md sticky-top">
            <div class="container">
                <a class="navbar-brand" href="#">My KinMen Map</a>
            </div>
        </nav>
    </header>
    <div class="swiper">
        <main class="container" style="overflow-x:auto;">
            <table class="table table-striped table-hover display" style="width: 100%;" id="my_table"></table>
        </main>
        <div class="swiper-button-prev disabled"></div>
        <div class="swiper-button-next disabled"></div>
    </div>
    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.datatables.net/2.0.0/js/dataTables.js"></script>
    <script src="https://cdn.datatables.net/2.0.0/js/dataTables.bootstrap5.js"></script>
    <script src="https://cdn.datatables.net/rowreorder/1.5.0/js/dataTables.rowReorder.js"></script>
    <script src="https://cdn.datatables.net/rowreorder/1.5.0/js/rowReorder.bootstrap5.js"></script>
    <script src="https://cdn.datatables.net/responsive/3.0.0/js/dataTables.responsive.js"></script>
    <script src="https://cdn.datatables.net/responsive/3.0.0/js/responsive.bootstrap5.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.0.7/js/swiper.min.js"></script>
    <script>
        (() => {
            'use strict'

            const getStoredTheme = () => localStorage.getItem('theme')
            const setStoredTheme = theme => localStorage.setItem('theme', theme)

            const getPreferredTheme = () => {
                const storedTheme = getStoredTheme()
                if (storedTheme) {
                    return storedTheme
                }

                return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'
            }

            const setTheme = theme => {
                if (theme === 'auto' && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    document.documentElement.setAttribute('data-bs-theme', 'dark')
                } else {
                    document.documentElement.setAttribute('data-bs-theme', theme)
                }
            }

            setTheme(getPreferredTheme())

            const showActiveTheme = (theme, focus = false) => {
                const themeSwitcher = document.querySelector('#bd-theme')

                if (!themeSwitcher) {
                    return
                }

                const themeSwitcherText = document.querySelector('#bd-theme-text')
                const activeThemeIcon = document.querySelector('.theme-icon-active use')
                const btnToActive = document.querySelector(`[data-bs-theme-value="${theme}"]`)
                const svgOfActiveBtn = btnToActive.querySelector('svg use').getAttribute('href')

                document.querySelectorAll('[data-bs-theme-value]').forEach(element => {
                    element.classList.remove('active')
                    element.setAttribute('aria-pressed', 'false')
                })

                btnToActive.classList.add('active')
                btnToActive.setAttribute('aria-pressed', 'true')
                activeThemeIcon.setAttribute('href', svgOfActiveBtn)
                const themeSwitcherLabel = `${themeSwitcherText.textContent} (${btnToActive.dataset.bsThemeValue})`
                themeSwitcher.setAttribute('aria-label', themeSwitcherLabel)

                if (focus) {
                    themeSwitcher.focus()
                }
            }

            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
                const storedTheme = getStoredTheme()
                if (storedTheme !== 'light' && storedTheme !== 'dark') {
                    setTheme(getPreferredTheme())
                }
            })

            window.addEventListener('DOMContentLoaded', () => {
                showActiveTheme(getPreferredTheme())

                document.querySelectorAll('[data-bs-theme-value]')
                    .forEach(toggle => {
                        toggle.addEventListener('click', () => {
                            const theme = toggle.getAttribute('data-bs-theme-value')
                            setStoredTheme(theme)
                            setTheme(theme)
                            showActiveTheme(theme, true)
                        })
                    })
            })
        })();
        (() => {
            'use strict';

            let table = new DataTable('#my_table', {
                responsive: true,
                lengthChange: false,
                rowReorder: {
                    selector: 'td:nth-child(2)'
                },
                ajax: {
                    url: 'data/data.json',
                    dataSrc: 'data'
                },
                columns: [
                    {
                        title: 'ADDR', data: 'ADDR',
                        render: function (data, type, row, meta) {
                            if (type === 'display') {
                                let params = {
                                    q: row['LATITUDE'] + ',' + row['LONGITUDE']
                                };
                                let url = "https://maps.google.com/?" + $.param(params, true);
                                return '<a href="' + url + '" target="_blank">' + data + '</a>';
                            }
                            return data;
                        }
                    },
                    { title: 'LATITUDE', data: 'LATITUDE', visible: false },
                    { title: 'LONGITUDE', data: 'LONGITUDE', visible: false },
                    { title: 'TOWN', data: 'TOWN' },
                    { title: 'ROAD', data: 'ROAD' },
                    { title: 'LANE', data: 'LANE' },
                    { title: 'ALLEY', data: 'ALLEY' },
                    { title: 'DOOR', data: 'DOOR' }
                ],
                processing: true,
                initComplete: function (settings, json) {
                    let info = settings.api.page.info();
                    let width = $(document).width();
                    if (width <= 767.98) {
                        if (info.page == 0) {
                            $('.swiper-button-prev').hide();
                        } else {
                            $('.swiper-button-prev').show();
                        }
                        if (info.page == info.pages - 1) {
                            $('.swiper-button-next').hide();
                        } else {
                            $('.swiper-button-next').show();
                        }
                        $('#my_table_wrapper .dt-paging').hide();
                    } else {
                        $('#my_table_wrapper .dt-paging').show();
                    }
                }
            });

            $('.swiper-button-prev').on('click', () => {
                table.page('previous').draw(false);
            })

            $('.swiper-button-next').on('click', () => {
                table.page('next').draw(false);
            });

            table.on('page', () => {
                let info = table.page.info();
                let width = $(document).width();
                if (width <= 767.98) {
                    if (info.page == 0) {
                        $('.swiper-button-prev').hide();
                    } else {
                        $('.swiper-button-prev').show();
                    }
                    if (info.page == info.pages - 1) {
                        $('.swiper-button-next').hide();
                    } else {
                        $('.swiper-button-next').show();
                    }
                    $('#my_table_wrapper .dt-paging').hide();
                } else {
                    $('#my_table_wrapper .dt-paging').show();
                }
            });

            $(window).resize(() => {
                let info = table.page.info();
                let width = $(document).width();
                if (width <= 767.98) {
                    if (info.page == 0) {
                        $('.swiper-button-prev').hide();
                    } else {
                        $('.swiper-button-prev').show();
                    }
                    if (info.page == info.pages - 1) {
                        $('.swiper-button-next').hide();
                    } else {
                        $('.swiper-button-next').show();
                    }
                    $('#my_table_wrapper .dt-paging').hide();
                } else {
                    $('#my_table_wrapper .dt-paging').show();
                }
            });
        })();
    </script>
</body>
</html>